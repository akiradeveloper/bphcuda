require_relative "common"

class Shocktube
  class Experiment
    def initialize(n, m, s, backend)
      @n = n
      @m = m
      @s = s
      @backedn = backend
    end
  
    def analytic_data
      "#{AnalyticDir}/shtb_g140_t010t020.dat"
    end
  
    def dirname
      dir = "#{DataDir}/shocktube_x/n#{n}_m#{m}_s#{s}_#{backend}"
    end
    
    def binname
      "shocktube_x/main_on_#{backend}.bin"
    end
    
    def run
      dir = dirname
      bin = binname
      # according to isaka's experiment, t is 0.15
      time = 0.15
      task dir => bin do |t|
        mkdir_p dir
        sh "#{bin} #{n} #{m} #{s} #{time} #{dir}/plot.dat #{dir}/time.dat"
      end
      task "shocktube_x" => dir
      task "run_all" => "shocktube_x"
    end
  end
end


if __FILE__ == $0
  x = Shocktube::Experiment.new 
  p x.analytic_data
  p x.dirname
  p x.binname
end
